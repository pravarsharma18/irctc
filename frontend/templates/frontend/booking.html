{% extends 'base.html' %} {% block content %}

<div
  class="content flex-row container"
  id="kt_content"
  style="margin-right: unset"
>
  <div class="d-inline-flex m-5 p-5 flex-column border">
    <form id="filter-train">
      <div class="mb-3">
        <label for="formGroupExampleInput" class="form-label"
          >Source Station</label
        >
        <input
          type="text"
          class="form-control"
          name="source_station"
          placeholder="City / Short Name"
          required
        />
      </div>
      <div class="mb-3">
        <label for="formGroupExampleInput2" class="form-label"
          >Destination Station</label
        >
        <input
          type="text"
          class="form-control"
          name="destination_station"
          placeholder="City / Short Name"
          required
        />
      </div>
      <div class="mb-3">
        <label for="formGroupExampleInput2" class="form-label">Date</label>
        <input
          type="date"
          class="form-control"
          name="date"
          placeholder="Date"
          required
        />
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary">Go</button>
      </div>
    </form>
  </div>

  <div class="d-inline-flex justify-content-between" id="display-trains">
    Please search your Train
  </div>
</div>
{% endblock content %} {% block js %}
<script>
  let form = $("#filter-train");
  form.submit(async (e) => {
    e.preventDefault();
    let params = {};
    $(form.serializeArray()).each(function (index, obj) {
      params[obj.name] = obj.value;
    });

    let url = new URL("{{url}}api/train/");
    Object.keys(params).forEach((key) =>
      url.searchParams.append(key, params[key])
    );
    console.log(url);
    let [res, json] = await _$.Fetch(url, (props = {}), (isArray = true));
    if (res.ok) {
      if (json["results"].length <= 0)
        return $("#display-trains").html("No trains Found");
      $("#display-trains").html(
        json["results"].map((t) => {
          return `<div class="col-3"><div class="card" style="width: 18rem;">
            <div class="card-body">
              <h5 class="card-title">${t.name}</h5>
              <h6 class="card-subtitle mb-2 text-muted">${t.number}</h6>
              <p class="card-text"></p>
              <a href="#" class="card-link">Book Now</a>
            </div>
          </div></div>`;
        })
      );
    } else {
      alert(json["detail"]);
    }
  });
</script>
{% endblock js %}
